function addChangeInstruction(e,n){e.changes?e.changes.splice(e.changes.length,0,n):e.changes=[n]}function findNextSibling(e,n,t){void 0===t&&(t=!1);var r,o=e.children;if(n+1<o.length)return 1===(r=o[n+1]).kind?r:2===r.kind?r:0===r.kind?findNextSibling(r,-1,!0):findNextSibling(e,n+1);if(1===e.kind)return null;if(0===e.kind){var a=e.parent;if(a&&a!==e)for(var i=0;a.children.length>i;i++)if(a.children[i]===e)return findNextSibling(a,i)}return null}function htmlRenderer(e,n,t){return new Renderer(e,n,t)}function processChanges(e,n,t){if(e&&e.changes&&e.changes.length){for(var r=0,o=e.changes;r<o.length;r++){var a=o[r];if(1===a.kind){var i=a;if(i.parent){var d=t.createDocFragment(),s=null,l=i.parent;if(l&&l.domNode&&(s=l.domNode.namespaceURI)&&s.match(RX_HTML)&&(s=null),processNode(i.node,d,t,s),l&&l.domNode){var c=!1;i.nextSibling?i.nextSibling.domNode&&(l.domNode.insertBefore(d,i.nextSibling.domNode),c=!0):(l.domNode.appendChild(d),c=!0),c&&replaceDomNode(d,l.domNode,i.node)}}else{d=t.createDocFragment();processNode(i.node,d,t,null),n.appendChild(d),replaceDomNode(d,n,i.node)}}else if(5===a.kind)(h=a.node)&&h.domNode&&(h.domNode.textContent=h.value);else if(3===a.kind){var p=a,h=p.node,u=p.name,s=void 0;h&&h.domNode&&((s=h.domNode.namespaceURI).match(RX_HTML)?"class"===u||"className"===u?h.domNode.className=p.value:h.domNode[u]=p.value:h.domNode.setAttribute(u,p.value))}else if(2===a.kind)removeGroupFromDom(a.node);else if(4===a.kind){var m=a;m.node.domNode.setAttribute(m.name,m.value)}else console.error("[iv html renderer] Unsupported change kind: "+a.kind)}e.changes=null}}function processNode(e,n,t,r){switch(e.kind){case 1:createElementDomNode(e,n,t,r);break;case 0:e.domNode=n,processChildNodes(e,n,t,r);break;case 2:var o=t.createTextNode(e.value);e.domNode=o,n.appendChild(o);break;default:console.error("[iv html renderer] Invalid node kind: "+e.kind)}}function processChildNodes(e,n,t,r){for(var o=e.children,a=o.length,i=0;a>i;i++)processNode(o[i],n,t,r)}function createElementDomNode(e,n,t,r){var o,a,i=e.props,d=e.atts;if(d&&d.xmlns&&(r=d.xmlns),a=r?t.createElementNS(r,e.name):t.createElement(e.name),i)if(r&&!r.match(RX_HTML))for(var s in i)i.hasOwnProperty(s)&&a.setAttribute(s,i[s]);else for(var s in i)i.hasOwnProperty(s)&&(o=i[s],"class"===s||"className"===s?a.className=o:"style"===s?a.setAttribute(s,o):o.call?s.match(RX_EVT_HANDLER)&&addEvtListener(a,e,s):a[s]=o);if(d)for(var s in d)d.hasOwnProperty(s)&&a.setAttribute(s,d[s]);e.domNode=a,n.appendChild(a),processChildNodes(e,a,t,r)}function addEvtListener(e,n,t){e.addEventListener(t.substring(2),function(e){n.props[t].call(n,e)})}function removeGroupFromDom(e){var n,t=e.children,r=e.domNode;if(t)for(var o=t.length,a=0;o>a;a++)0===(n=t[a]).kind?removeGroupFromDom(n):1===n.kind?(r.removeChild(n.domNode),n.domNode=null):2===n.kind&&(r.removeChild(n.domNode),n.domNode=null);e.domNode=null}function replaceDomNode(e,n,t){if(e!==n&&t.domNode===e&&(t.domNode=n,0===t.kind))for(var r=t.children,o=0;r.length>o;o++)replaceDomNode(e,n,r[o])}function jfb(e,n){var t,r,o,a,i,d,s,l,c,p,h,u,m,f,v,b,g,k,N=e.parent,y=e.rt,x=y.createEltNode,w=y.createTxtNode,C=y.updateProp,R=y.checkGroup,M=y.dynTxtNode,D=y.updateText,E=y.deleteGroups,T=n.benchmark;h=function(){T.run()},u=function(){T.runLots()},m=function(){T.add()},f=function(){T.update()},v=function(){T.clear()},b=function(){T.swapRows()},N.cm?((t=x(N,1,"div",0)).props={class:"container"},(r=x(t,2,"div",0)).props={class:"jumbotron"},(o=x(r,3,"div",1)).props={class:"row"},(a=x(o,4,"div",0)).props={class:"col-md-6"},w(i=x(a,5,"h1",0),6,"IV"),(a=x(o,7,"div",0)).props={class:"col-md-6"},(i=x(a,8,"div",0)).props={class:"col-sm-6 smallpad"},(d=x(i,9,"button",0)).props={type:"button",class:"btn btn-primary btn-block",id:"run",onclick:h,ref:"text"},w(d,10,"Create 1,000 rows"),(i=x(a,11,"div",0)).props={class:"col-sm-6 smallpad"},(d=x(i,12,"button",0)).props={type:"button",class:"btn btn-primary btn-block",id:"runlots",onclick:u},w(d,13,"Create 10,000 rows"),(i=x(a,14,"div",0)).props={class:"col-sm-6 smallpad"},(d=x(i,15,"button",0)).props={type:"button",class:"btn btn-primary btn-block",id:"add",onclick:m,ref:"text"},w(d,16,"Append 1,000 rows"),(i=x(a,17,"div",0)).props={class:"col-sm-6 smallpad"},(d=x(i,18,"button",0)).props={type:"button",class:"btn btn-primary btn-block",id:"update",onclick:f},w(d,19,"Update every 10th row"),(i=x(a,20,"div",0)).props={class:"col-sm-6 smallpad"},(d=x(i,21,"button",0)).props={type:"button",class:"btn btn-primary btn-block",id:"clear",onclick:v},w(d,22,"Clear"),(i=x(a,23,"div",0)).props={class:"col-sm-6 smallpad"},(d=x(i,24,"button",0)).props={type:"button",class:"btn btn-primary btn-block",id:"swaprows",onclick:b},w(d,25,"Swap Rows"),(r=x(t,26,"table",0)).props={class:"table table-hover table-striped test-data"},o=x(r,27,"tbody",1)):(r=(t=N.children[0]).children[0],o=r.children[0],a=o.children[1],i=a.children[0],d=i.children[0],C("onclick",h,d,N),i=a.children[1],d=i.children[0],C("onclick",u,d,N),i=a.children[2],d=i.children[0],C("onclick",m,d,N),i=a.children[3],d=i.children[0],C("onclick",f,d,N),i=a.children[4],d=i.children[0],C("onclick",v,d,N),i=a.children[5],d=i.children[0],C("onclick",b,d,N),r=t.children[1],o=r.children[0]),c=0,T.data.forEach(function(e){a=R(c,o,N,N,28),c++,p=0,g=function(n){T.select(e,n)},k=function(n){T.delete(e,n)},a.cm?((i=x(a,29,"tr",1)).props={class:e.id===T.selected?"danger":""},(d=x(i,30,"td",0)).props={class:"col-md-1"},M(d,31,""+e.id),(d=x(i,32,"td",0)).props={class:"col-md-4"},(s=x(d,33,"a",0)).props={href:"#",onclick:g},M(s,34,""+e.label),(d=x(i,35,"td",0)).props={class:"col-md-1"},(s=x(d,36,"a",0)).props={href:"#",onclick:k},(l=x(s,37,"span",0)).props={class:"glyphicon glyphicon-remove"},(d=x(i,38,"td",0)).props={class:"col-md-6"},a.cm=0):(i=a.children[0],C("class",e.id===T.selected?"danger":"",i,N),d=i.children[0],s=d.children[0],D(""+e.id,s,N),d=i.children[1],s=d.children[0],C("onclick",g,s,N),l=s.children[0],D(""+e.label,l,N),d=i.children[2],s=d.children[0],C("onclick",k,s,N))}),N.cm?((r=x(t,39,"span",0)).props={class:"preloadicon glyphicon glyphicon-remove"},N.cm=0):E(c,o,N,39)}var ivRuntime={refCount:0,createEltNode:function(e,n,t,r){var o={kind:1,index:n,name:t,ref:r?++ivRuntime.refCount:0,children:[],domNode:null};return e.children[e.children.length]=o,o},createCpt:function(e,n,t,r,o,a){var i={kind:0,index:n,cm:1,vdFunction:a,props:t,changes:null,ref:r?++ivRuntime.refCount:0,children:[],domNode:null,parent:e},d=o.parent;return e.children[e.children.length]=i,o.parent=i,a(o,t),o.parent=d,i},checkGroup:function(e,n,t,r,o){var a=n.children[e];if(a&&a.index===o)return a;var i={kind:0,index:o,cm:1,props:{},changes:null,ref:++ivRuntime.refCount,children:[],domNode:null,parent:n};return r.cm?n.children[n.children.length]=i:(n.children.splice(e,0,i),addChangeInstruction(t,{kind:1,node:i,parent:n,position:e,nextSibling:findNextSibling(n,e)})),i},deleteGroups:function(e,n,t,r){for(var o=n.children[e];o&&o.index<r;)n.children.splice(e,1),addChangeInstruction(t,{kind:2,node:o,parent:n,position:e}),o=n.children[e]},createTxtNode:function(e,n,t){var r={kind:2,index:n,value:t,ref:0,domNode:null};e.children[e.children.length]=r},dynTxtNode:function(e,n,t){var r={kind:2,index:n,value:t,ref:++ivRuntime.refCount,domNode:null};e.children[e.children.length]=r},updateProp:function(e,n,t,r){t.props[e]!==n&&(t.props[e]=n,n.call||addChangeInstruction(r,{kind:3,name:e,value:n,node:t}))},updateAtt:function(e,n,t,r){t.atts[e]!==n&&(t.atts[e]=n,n.call||addChangeInstruction(r,{kind:4,name:e,value:n,node:t}))},updateText:function(e,n,t){n.value!==e&&(n.value=e,addChangeInstruction(t,{kind:5,value:e,node:n}))},updateCptProp:function(e,n,t){t.props[e]=n},refreshCpt:function(e,n,t){var r=e.parent,o=n;e.parent=o,o.vdFunction(e,o.props),e.parent=r,o.changes&&(t.changes?t.changes=t.changes.concat(o.changes):t.changes=o.changes,o.changes=null)}},RX_EVT_HANDLER=/^on/,RX_HTML=/html/i,Renderer=function(){function e(e,n,t){this.htmlElement=e,this.vdFunction=n,this.rt=ivRuntime;var r=this.vdom={kind:0,index:0,ref:++ivRuntime.refCount,cm:1,changes:null,children:[],domNode:null,parent:null},o={kind:1,node:r,parent:null,position:-1,nextSibling:null};r.changes=[o],this.doc=t||{createDocFragment:function(){return new DocumentFragment},createTextNode:function(e){return document.createTextNode(e)},createElement:function(e){return document.createElement(e)},createElementNS:function(e,n){return document.createElementNS(e,n)}}}return e.prototype.refresh=function(e){this.parent=this.vdom,this.vdFunction(this,e),processChanges(this.vdom,this.htmlElement,this.doc)},e}(),startTime,lastMeasure,startMeasure=function(e){startTime=performance.now(),lastMeasure=e},stopMeasure=function(){var e=lastMeasure;lastMeasure&&window.setTimeout(function(){lastMeasure="";var n=performance.now();console.log(e+" took "+(n-startTime))},0)},Benchmark=function(){function e(e){this.data=[],this.selected=-1,this.id=1,this.renderer=e}return e.prototype.refresh=function(){this.renderer.refresh({benchmark:this}),stopMeasure()},e.prototype.buildData=function(e){void 0===e&&(e=1e3);for(var n=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],t=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],r=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"],o=[],a=0;a<e;a++)o.push({id:this.id,label:n[this._random(n.length)]+" "+t[this._random(t.length)]+" "+r[this._random(r.length)]}),this.id++;return o},e.prototype._random=function(e){return Math.round(1e3*Math.random())%e},e.prototype.select=function(e,n){startMeasure("select"),n.preventDefault(),this.selected=e.id,this.refresh()},e.prototype.delete=function(e,n){n.preventDefault(),startMeasure("delete");for(var t=0,r=this.data.length;t<r;t++)if(this.data[t].id===e.id){this.data.splice(t,1);break}this.refresh()},e.prototype.run=function(){startMeasure("run"),this.data=this.buildData(),this.refresh()},e.prototype.add=function(){startMeasure("add"),this.data=this.data.concat(this.buildData(1e3)),this.refresh()},e.prototype.update=function(){startMeasure("update");for(var e=0;e<this.data.length;e+=10)this.data[e].label+=" !!!";this.refresh()},e.prototype.runLots=function(){startMeasure("runLots"),this.data=this.buildData(1e4),this.selected=-1,this.refresh()},e.prototype.clear=function(){startMeasure("clear"),this.data=[],this.selected=-1,this.refresh()},e.prototype.swapRows=function(){if(startMeasure("swapRows"),this.data.length>10){var e=this.data[4];this.data[4]=this.data[9],this.data[9]=e}this.refresh()},e}(),renderer=htmlRenderer(document.getElementById("root"),jfb),benchmark=new Benchmark(renderer);benchmark.refresh();
